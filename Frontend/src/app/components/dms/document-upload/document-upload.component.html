<div class="upload-dialog-overlay">
  <mat-card class="upload-dialog">
    <mat-card-header>
      <mat-card-title>Upload Documents</mat-card-title>
      <button mat-icon-button (click)="cancel()" class="close-button">
        <mat-icon>close</mat-icon>
      </button>
    </mat-card-header>

    <mat-card-content>
      <!-- File Drop Zone -->
      <div class="drop-zone"
           (drop)="onFilesDropped($event)"
           (dragover)="onDragOver($event)"
           [class.has-files]="files.length > 0">
        <div *ngIf="files.length === 0" class="drop-zone-content">
          <mat-icon>cloud_upload</mat-icon>
          <h3>Drag and drop files here</h3>
          <p>or</p>
          <button mat-raised-button color="primary" onclick="document.getElementById('file-input').click()">
            Browse Files
          </button>
          <input id="file-input"
                 type="file"
                 multiple
                 hidden
                 (change)="onFileSelected($event)">
          <p class="limits">Max file size: 100 MB (single) or 500 MB (bulk)</p>
        </div>

        <!-- Selected Files List -->
        <div *ngIf="files.length > 0" class="files-list">
          <h4>Selected Files ({{ files.length }})</h4>
          <div class="file-item" *ngFor="let file of files; let i = index">
            <mat-icon class="file-icon">insert_drive_file</mat-icon>
            <div class="file-info">
              <div class="file-name">{{ file.name }}</div>
              <div class="file-size">{{ formatFileSize(file.size) }}</div>
            </div>
            <button mat-icon-button (click)="removeFile(i)" [disabled]="uploading">
              <mat-icon>close</mat-icon>
            </button>
          </div>
          <button mat-button onclick="document.getElementById('file-input').click()" [disabled]="uploading">
            <mat-icon>add</mat-icon>
            Add More Files
          </button>
        </div>
      </div>

      <!-- Document Metadata Form (only for single file) -->
      <div class="metadata-form" *ngIf="files.length === 1">
        <h4>Document Details</h4>

        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Title</mat-label>
          <input matInput [(ngModel)]="title" required [disabled]="uploading">
        </mat-form-field>

        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Description</mat-label>
          <textarea matInput [(ngModel)]="description" rows="3" [disabled]="uploading"></textarea>
        </mat-form-field>

        <div class="form-row">
          <mat-form-field appearance="outline">
            <mat-label>Category</mat-label>
            <mat-select [(ngModel)]="category" [disabled]="uploading">
              <mat-option *ngFor="let cat of categories" [value]="cat">
                {{ cat }}
              </mat-option>
            </mat-select>
          </mat-form-field>

          <mat-form-field appearance="outline">
            <mat-label>Access Level</mat-label>
            <mat-select [(ngModel)]="accessLevel" [disabled]="uploading">
              <mat-option *ngFor="let level of accessLevels" [value]="level">
                {{ level }}
              </mat-option>
            </mat-select>
          </mat-form-field>
        </div>

        <div class="tags-input">
          <mat-chip-list>
            <mat-chip *ngFor="let tag of tags" [removable]="!uploading" (removed)="removeTag(tag)">
              {{ tag }}
              <mat-icon matChipRemove>cancel</mat-icon>
            </mat-chip>
          </mat-chip-list>
          <mat-form-field appearance="outline" class="tag-input-field">
            <mat-label>Add Tags</mat-label>
            <input matInput
                   [(ngModel)]="tagInput"
                   (keyup.enter)="addTag()"
                   placeholder="Type and press Enter"
                   [disabled]="uploading">
          </mat-form-field>
        </div>
      </div>

      <!-- Upload Progress -->
      <div class="upload-progress" *ngIf="uploading">
        <mat-progress-bar mode="determinate" [value]="uploadProgress"></mat-progress-bar>
        <p>Uploading... {{ uploadProgress }}%</p>
      </div>
    </mat-card-content>

    <mat-card-actions align="end">
      <button mat-button (click)="cancel()" [disabled]="uploading">Cancel</button>
      <button mat-raised-button color="primary"
              (click)="upload()"
              [disabled]="files.length === 0 || uploading || (files.length === 1 && !title)">
        <mat-icon>cloud_upload</mat-icon>
        Upload {{ files.length > 1 ? files.length + ' Files' : '' }}
      </button>
    </mat-card-actions>
  </mat-card>
</div>
