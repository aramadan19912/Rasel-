<div class="folder-dialog-overlay">
  <mat-card class="folder-dialog">
    <mat-card-header>
      <mat-card-title>{{ isEditMode ? 'Edit Folder' : 'Create New Folder' }}</mat-card-title>
      <button mat-icon-button (click)="cancel()" class="close-button">
        <mat-icon>close</mat-icon>
      </button>
    </mat-card-header>

    <mat-card-content>
      <form>
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Folder Name</mat-label>
          <input matInput [(ngModel)]="name" name="name" required [disabled]="saving">
        </mat-form-field>

        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Description</mat-label>
          <textarea matInput [(ngModel)]="description" name="description" rows="3" [disabled]="saving"></textarea>
        </mat-form-field>

        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Access Level</mat-label>
          <mat-select [(ngModel)]="accessLevel" name="accessLevel" [disabled]="saving">
            <mat-option *ngFor="let level of accessLevels" [value]="level">
              {{ level }}
            </mat-option>
          </mat-select>
          <mat-hint>Controls who can access this folder</mat-hint>
        </mat-form-field>

        <div class="permissions-section" *ngIf="accessLevel === 'Private' || accessLevel === 'Restricted'">
          <h4>Allowed Users</h4>
          <div class="chips-container">
            <mat-chip-grid>
              <mat-chip-row *ngFor="let user of allowedUsers" [removable]="!saving" (removed)="removeUser(user)">
                {{ user }}
                <button matChipRemove>
                  <mat-icon>cancel</mat-icon>
                </button>
              </mat-chip-row>
            </mat-chip-grid>
          </div>
          <div class="add-permission">
            <mat-form-field appearance="outline">
              <mat-label>Add User (email or username)</mat-label>
              <input matInput
                     [(ngModel)]="userInput"
                     name="userInput"
                     (keyup.enter)="addUser()"
                     [disabled]="saving">
            </mat-form-field>
            <button mat-icon-button (click)="addUser()" [disabled]="!userInput || saving">
              <mat-icon>add</mat-icon>
            </button>
          </div>

          <h4>Allowed Roles</h4>
          <div class="chips-container">
            <mat-chip-grid>
              <mat-chip-row *ngFor="let role of allowedRoles" [removable]="!saving" (removed)="removeRole(role)">
                {{ role }}
                <button matChipRemove>
                  <mat-icon>cancel</mat-icon>
                </button>
              </mat-chip-row>
            </mat-chip-grid>
          </div>
          <div class="add-permission">
            <mat-form-field appearance="outline">
              <mat-label>Add Role</mat-label>
              <input matInput
                     [(ngModel)]="roleInput"
                     name="roleInput"
                     (keyup.enter)="addRole()"
                     [disabled]="saving">
            </mat-form-field>
            <button mat-icon-button (click)="addRole()" [disabled]="!roleInput || saving">
              <mat-icon>add</mat-icon>
            </button>
          </div>
        </div>
      </form>
    </mat-card-content>

    <mat-card-actions align="end">
      <button mat-button (click)="cancel()" [disabled]="saving">Cancel</button>
      <button mat-raised-button color="primary"
              (click)="save()"
              [disabled]="!name || saving">
        <mat-icon>{{ isEditMode ? 'save' : 'create_new_folder' }}</mat-icon>
        {{ isEditMode ? 'Save' : 'Create' }}
      </button>
    </mat-card-actions>
  </mat-card>
</div>
