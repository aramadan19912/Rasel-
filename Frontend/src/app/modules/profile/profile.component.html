<div class="profile-container" *ngIf="!loading">
  <div class="profile-header">
    <h1>{{ 'profile.title' | translate }}</h1>
  </div>

  <mat-tab-group animationDuration="0ms">
    <!-- Profile Information Tab -->
    <mat-tab label="{{ 'profile.tabs.information' | translate }}">
      <div class="tab-content">
        <mat-card class="profile-section">
          <mat-card-header>
            <mat-card-title>{{ 'profile.personalInfo' | translate }}</mat-card-title>
          </mat-card-header>
          <mat-card-content>
            <!-- Avatar Section -->
            <div class="avatar-section">
              <div class="avatar-preview">
                <img *ngIf="avatarPreview" [src]="avatarPreview" alt="Avatar">
                <div *ngIf="!avatarPreview" class="avatar-placeholder">
                  <mat-icon>person</mat-icon>
                </div>
              </div>
              <div class="avatar-actions">
                <input #avatarInput type="file" accept="image/*" (change)="onAvatarSelected($event)" style="display: none">
                <button mat-raised-button (click)="avatarInput.click()">
                  <mat-icon>upload</mat-icon>
                  {{ 'profile.uploadAvatar' | translate }}
                </button>
                <button mat-button *ngIf="avatarPreview" (click)="removeAvatar()">
                  <mat-icon>delete</mat-icon>
                  {{ 'profile.removeAvatar' | translate }}
                </button>
              </div>
            </div>

            <!-- Profile Form -->
            <form [formGroup]="profileForm" (ngSubmit)="saveProfile()">
              <div class="form-grid">
                <!-- First Name -->
                <mat-form-field appearance="outline">
                  <mat-label>{{ 'profile.firstName' | translate }} *</mat-label>
                  <input matInput formControlName="firstName">
                  <mat-icon matIconPrefix>person</mat-icon>
                  <mat-error *ngIf="profileForm.get('firstName')?.invalid">
                    {{ getErrorMessage(profileForm, 'firstName') }}
                  </mat-error>
                </mat-form-field>

                <!-- Last Name -->
                <mat-form-field appearance="outline">
                  <mat-label>{{ 'profile.lastName' | translate }} *</mat-label>
                  <input matInput formControlName="lastName">
                  <mat-icon matIconPrefix>person</mat-icon>
                  <mat-error *ngIf="profileForm.get('lastName')?.invalid">
                    {{ getErrorMessage(profileForm, 'lastName') }}
                  </mat-error>
                </mat-form-field>

                <!-- Email (disabled) -->
                <mat-form-field appearance="outline">
                  <mat-label>{{ 'profile.email' | translate }}</mat-label>
                  <input matInput formControlName="email">
                  <mat-icon matIconPrefix>email</mat-icon>
                  <mat-hint>{{ 'profile.emailHint' | translate }}</mat-hint>
                </mat-form-field>

                <!-- Phone Number -->
                <mat-form-field appearance="outline">
                  <mat-label>{{ 'profile.phoneNumber' | translate }}</mat-label>
                  <input matInput formControlName="phoneNumber">
                  <mat-icon matIconPrefix>phone</mat-icon>
                  <mat-error *ngIf="profileForm.get('phoneNumber')?.invalid">
                    {{ getErrorMessage(profileForm, 'phoneNumber') }}
                  </mat-error>
                </mat-form-field>

                <!-- Position -->
                <mat-form-field appearance="outline">
                  <mat-label>{{ 'profile.position' | translate }}</mat-label>
                  <input matInput formControlName="position">
                  <mat-icon matIconPrefix>work</mat-icon>
                </mat-form-field>

                <!-- Department -->
                <mat-form-field appearance="outline">
                  <mat-label>{{ 'profile.department' | translate }}</mat-label>
                  <input matInput formControlName="department">
                  <mat-icon matIconPrefix>business</mat-icon>
                </mat-form-field>

                <!-- Bio -->
                <mat-form-field appearance="outline" class="full-width">
                  <mat-label>{{ 'profile.bio' | translate }}</mat-label>
                  <textarea matInput formControlName="bio" rows="4" [placeholder]="'profile.bioPlaceholder' | translate"></textarea>
                  <mat-icon matIconPrefix>description</mat-icon>
                  <mat-error *ngIf="profileForm.get('bio')?.invalid">
                    {{ getErrorMessage(profileForm, 'bio') }}
                  </mat-error>
                </mat-form-field>
              </div>

              <div class="form-actions">
                <button mat-raised-button color="primary" type="submit" [disabled]="submitting || profileForm.invalid">
                  <mat-icon>save</mat-icon>
                  {{ 'profile.saveChanges' | translate }}
                </button>
              </div>
            </form>
          </mat-card-content>
        </mat-card>
      </div>
    </mat-tab>

    <!-- Security Tab -->
    <mat-tab label="{{ 'profile.tabs.security' | translate }}">
      <div class="tab-content">
        <mat-card class="profile-section">
          <mat-card-header>
            <mat-card-title>{{ 'profile.changePassword' | translate }}</mat-card-title>
          </mat-card-header>
          <mat-card-content>
            <form [formGroup]="passwordForm" (ngSubmit)="changePassword()">
              <div class="form-grid">
                <!-- Current Password -->
                <mat-form-field appearance="outline" class="full-width">
                  <mat-label>{{ 'profile.currentPassword' | translate }} *</mat-label>
                  <input matInput type="password" formControlName="currentPassword">
                  <mat-icon matIconPrefix>lock</mat-icon>
                  <mat-error *ngIf="passwordForm.get('currentPassword')?.invalid">
                    {{ getErrorMessage(passwordForm, 'currentPassword') }}
                  </mat-error>
                </mat-form-field>

                <!-- New Password -->
                <mat-form-field appearance="outline" class="full-width">
                  <mat-label>{{ 'profile.newPassword' | translate }} *</mat-label>
                  <input matInput type="password" formControlName="newPassword">
                  <mat-icon matIconPrefix>lock_open</mat-icon>
                  <mat-error *ngIf="passwordForm.get('newPassword')?.invalid">
                    {{ getErrorMessage(passwordForm, 'newPassword') }}
                  </mat-error>
                  <mat-hint>{{ 'profile.passwordHint' | translate }}</mat-hint>
                </mat-form-field>

                <!-- Confirm Password -->
                <mat-form-field appearance="outline" class="full-width">
                  <mat-label>{{ 'profile.confirmPassword' | translate }} *</mat-label>
                  <input matInput type="password" formControlName="confirmPassword">
                  <mat-icon matIconPrefix>lock_check</mat-icon>
                  <mat-error *ngIf="passwordForm.get('confirmPassword')?.invalid">
                    {{ getErrorMessage(passwordForm, 'confirmPassword') }}
                  </mat-error>
                  <mat-error *ngIf="passwordForm.hasError('mismatch')">
                    {{ 'profile.errors.passwordMismatch' | translate }}
                  </mat-error>
                </mat-form-field>
              </div>

              <div class="form-actions">
                <button mat-raised-button color="primary" type="submit" [disabled]="submitting || passwordForm.invalid">
                  <mat-icon>vpn_key</mat-icon>
                  {{ 'profile.changePassword' | translate }}
                </button>
              </div>
            </form>
          </mat-card-content>
        </mat-card>

        <!-- Additional Security Settings -->
        <mat-card class="profile-section">
          <mat-card-header>
            <mat-card-title>{{ 'profile.additionalSecurity' | translate }}</mat-card-title>
          </mat-card-header>
          <mat-card-content>
            <div class="security-info">
              <div class="info-item">
                <mat-icon>calendar_today</mat-icon>
                <div class="info-content">
                  <strong>{{ 'profile.accountCreated' | translate }}:</strong>
                  <span>{{ userProfile?.createdAt | date: 'medium' }}</span>
                </div>
              </div>
              <div class="info-item">
                <mat-icon>update</mat-icon>
                <div class="info-content">
                  <strong>{{ 'profile.lastUpdated' | translate }}:</strong>
                  <span>{{ userProfile?.updatedAt | date: 'medium' }}</span>
                </div>
              </div>
            </div>
          </mat-card-content>
        </mat-card>
      </div>
    </mat-tab>
  </mat-tab-group>
</div>

<!-- Loading State -->
<div class="loading-container" *ngIf="loading">
  <mat-spinner></mat-spinner>
  <p>{{ 'common.loading' | translate }}</p>
</div>
